# Техническая документация приложения

## Обзор

Приложение для создания симметричных портретов с использованием ML для детекции
лица и автоматического выравнивания.

## Технический стек

### Frontend

- **React 18+**
- **TypeScript 4.x**
- **Next.js 13+**
- **react-easy-crop**: для UI кропа изображений
- **@telegram-apps/sdk-react**: интеграция с Telegram WebApp

### ML и обработка изображений

- **TensorFlow.js**: ML фреймворк
- **Blazeface**: модель детекции лица
- **Canvas API**: обработка изображений

## Основные компоненты

### 1. Захват изображения

- WebRTC API для доступа к камере
- File API для загрузки изображений
- Поддерживаемые форматы: JPEG, PNG
- Автоматическое масштабирование

### 2. Детекция лица

- Модель Blazeface
- Определение ключевых точек:
  - Глаза
  - Нос
  - Рот
- Вычисление угла наклона
- Определение центральной линии

### 3. Обработка изображения

- Интерактивный кроп (react-easy-crop)
- Программный кроп (Canvas API)
- Создание симметрии:
  - Левая половина → правая
  - Правая половина → левая

## API

### MediaDevices API

```typescript
navigator.mediaDevices.getUserMedia({
  video: {
    width: { ideal: 1920 },
    height: { ideal: 1080 },
  },
});
```

### Canvas API

```typescript
// Создание симметрии
ctx.translate(centerX, 0);
ctx.scale(-1, 1);
ctx.drawImage(source, ...coordinates);
```

### ML API

```typescript
// Загрузка модели
const model = await blazeface.load();
// Детекция
const predictions = await model.estimateFaces(image);
```

## Рекомендации по разработке

### Оптимизация

- Используйте `useCallback` для тяжелых функций обработки изображений
- Применяйте `React.memo` для компонентов, которые редко обновляются
- Кэшируйте результаты ML-модели
- Оптимизируйте размер canvas перед обработкой

### Обработка ошибок

- Проверяйте доступность камеры
- Валидируйте загружаемые файлы
- Обрабатывайте ошибки ML-модели
- Информируйте пользователя о проблемах

### Тестирование

- Проверка работы с разными размерами изображений
- Тестирование на мобильных устройствах
- Проверка граничных случаев детекции лица
- Тестирование производительности
